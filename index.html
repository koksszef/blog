<!DOCTYPE html>
<html lang="pl">
<head>
    <link rel="stylesheet" href="/css/style.css">
    <style>
  canvas {
      margin: 50px auto 0;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: block;
    position: fixed;
    width: 70vw;
    height: 70vh;
    pointer-events: none;
  }
  .spacer {
    height: calc(100vh + 60 * 8px);
  }
  .ladowanie{
    position: fixed;
    font-weight: bold;
    color: var(--brown-light);
    text-align: center;
          left: 50%;
    bottom: 50%;
    transform: translate(-50%, -50%);
  }
  header{
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  }
  .container{
      margin-top: 50;
      position: fixed;
      text-align: center;
        top: 96px;
  left: 50%;
      transform: translateX(-50%);
  width: 100%;
  }
        
</style>
</head>
<body>
    <script src="/js/header.js"></script>
    <div class="container">
        <!-- Treść strony -->
        <h2 class="section-title">bronpalna-blog.pl</h2>
    </div>
    <div id="loader" class="ladowanie">Ładowanie zdjęć…</div>
        <canvas id="adsCanvas"></canvas>
<div class="spacer"></div>

<script>
window.addEventListener("DOMContentLoaded", () => {

  const canvas = document.getElementById("adsCanvas");
  if (!canvas) return;

  const ctx = canvas.getContext("2d");
  const loader = document.getElementById("loader");

  // ===== CONFIG =====
  const frameCount = 60;
  const imagePath = "/frames/";
  const fileExtension = ".png";
  const padLength = 4;
  const maxCanvasSize = 2048; // mobile safe
  // ==================

  const images = [];
  let loadedImages = 0;
  let currentFrame = 0;

function resizeCanvas() {
  const dpr = window.devicePixelRatio || 1;

  // Full width/height of viewport, scaled down slightly
  let cssWidth = Math.min(window.innerWidth, window.innerWidth * 0.7);
  let cssHeight = window.innerHeight * 0.7;

  // Respect maxCanvasSize
  if (cssWidth * dpr > maxCanvasSize) cssWidth = maxCanvasSize / dpr;
  if (cssHeight * dpr > maxCanvasSize) cssHeight = maxCanvasSize / dpr;

  canvas.width = cssWidth * dpr;
  canvas.height = cssHeight * dpr;

  canvas.style.width = cssWidth + "px";
  canvas.style.height = cssHeight + "px";

  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}
function drawFrame(index) {
  const img = images[index];
  if (!img) return;

  // Reset transform to identity before clearing
  ctx.setTransform(1, 0, 0, 1, 0, 0);
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const cssWidth = canvas.width / (window.devicePixelRatio || 1);
  const cssHeight = canvas.height / (window.devicePixelRatio || 1);

  const scale = Math.min(cssWidth / img.width, cssHeight / img.height);
  const x = (cssWidth - img.width * scale) / 2;
  const y = (cssHeight - img.height * scale) / 2;

  // Reapply transform for HiDPI rendering
  const dpr = window.devicePixelRatio || 1;
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

  ctx.drawImage(img, x, y, img.width * scale, img.height * scale);
}

  function preloadImages() {
    for (let i = 1; i <= frameCount; i++) {
      const img = new Image();
      img.src = imagePath + String(i).padStart(padLength, "0") + fileExtension;

      img.onload = () => {
        loadedImages++;
        if (loader) loader.textContent = `Ładowanie zdjęć… ${loadedImages}/${frameCount}`;

        if (img.decode) {
          img.decode().finally(() => {
            if (loadedImages === frameCount) {
              if (loader) loader.style.display = "none";
              drawFrame(0);
            }
          });
        } else if (loadedImages === frameCount) {
          if (loader) loader.style.display = "none";
          drawFrame(0);
        }
      };

      images.push(img);
    }
  }

  window.addEventListener("scroll", () => {
    const scrollTop = window.scrollY;
    const maxScroll = document.body.scrollHeight - window.innerHeight;
    const scrollFraction = scrollTop / maxScroll;

    currentFrame = Math.min(frameCount - 1, Math.floor(scrollFraction * frameCount));
    drawFrame(currentFrame);
  });

  window.addEventListener("resize", () => {
    resizeCanvas();
    drawFrame(currentFrame);
  });

  // Initial setup
  resizeCanvas();
  preloadImages();

});
</script>

    <script src="/js/footer.js"></script>
</body>


</html>










